<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Haus of Decline</title>

  <link rel="shortcut icon" type="image/x-icon" href="./favicon.jpg" id="favicon">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#000" />

  <meta name="description" content="">
  <meta name="keywords" content="">

  <meta name="twitter:image" content="">
  <meta name="twitter:image:alt" content="">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:creator" content="@hausofdecline">
  <meta name="twitter:site" content="@hausofdecline">
  <meta property="twitter:description" content="">

  <meta name="og:image" property="og:image" content="">
  <meta name="og:image:alt" content="">
  <meta property="og:type" content="website">
  <meta property="og:url" content="">
  <meta property="og:title" content="">
  <meta property="og:site_name" content="">
  <meta property="og:description" content="">


  <link rel="stylesheet" type="text/css" href="./style.css">

  <style type="text/css">


    @import url('https://fonts.googleapis.com/css2?family=Permanent+Marker');


    * {
      font-family: sans-serif;
      --text-color:  var(--dark-color);
      --bg-color: var(--light-color);

      font-family: "Font Of Decline", sans-serif;
      font-optical-sizing: auto;
    }


    body {
      background: var(--bg-color);
      color: var(--text-color);
      background-image: url("./assets/bg.jpg");
    }

    body.darkmode * {
      --accent-color: var(--light-color);
      --text-color:  var(--light-color);
      --bg-color: var(--dark-color);
      --border-color: var(--light-color);
      color: var(--text-color);
      /*background-image: url("./assets/bg-invered.jpg");*/
    }

    #title {
      padding: 0.5em;
      text-align: center;
      line-height: 0;
    }

    #title img {
      filter: invert(1) contrast(2);
      max-height: 120px;
      width: auto;
      height: auto;
    }
    .darkmode #title img {
      filter:  contrast(2);

    }

    a, a:visited {
      color: var(--text-color);
    }

    a:hover {
      text-decoration: none;
    }

    header {
      margin-bottom: 1em;
    }



    img.comic {
      max-width: 100%;
      /*max-height: 70vh;*/
      width: auto;
      height: auto;
    }

    .comicContainer {
      margin-top: 2.5em;
      display: flex;
      justify-content: center;
      /*align-items: center;*/
      flex-direction: column;
    }

    #comicTitle {
      padding-left: 1.1em;
      font-size: 1em;
      font-weight: normal;
      text-align: left;
    }

    .publication {
      font-size: 0.75em;

    }
    nav {
      display: flex;
      justify-content: space-around;
    }


    header, main, footer {
      background: var(--bg-color);
    }

    nav a {
      font-size: 1.25em;
    }

    footer {
      display: flex;
      justify-content: space-between;
      margin: 1em auto;
      width: 320px;
    }

    button {
      padding: 0.4em 0.75em;
      background: var(--text-color);
      color: var(--bg-color);
      border: 0;
      border-radius: 2px;
    }

    input {
      padding: 0.25em;
    }

    .comicControls, .comicControls2 {
      display: flex;
      justify-content: space-around;
      margin:  auto;
      max-width: 320px;
      width: 100%;
    }

    .comicControls div, .comicControls2 div {
      font-size: 2em;
      cursor: pointer;
      user-select: none
    }

/*    .comicControls div:hover, .comicControls2 div:hover {
      opacity: 0.8;
    }
    .comicControls div:active, .comicControls2 div:active {
      opacity: 0.7;
    }*/

    .disabled {
      user-select: none;
      opacity: 0.25;
      cursor: unset !important;
    }

    .searchBar {
      text-align: center;
      margin: 0.5em 0;
    }

    .mobileNAV {
      display: none;
      text-align: center;
    }

    .borderimg {
      border: 20px solid transparent;
      border-image: url('./assets/border-image.png') 60 round;
    }



    @media (max-width:  640px) {
      .mobileNAV {
        display: block;
      }

      .desktopNAV {
        display: none;

      }

      nav a {
        font-size: 0.9em;
        margin: 0 0.25em;
      }
    }

  </style>
</head>
<body>
  <header>
    <!-- <img id="title" src="./Haus_of_Decline_Long.jpg"> -->
    <h1 id="title">
      <img  src="./assets/Haus_of_Decline_Cropped.jpeg" alt="HAUS OF DECLINE">
    </h1>
    <nav class="desktopNAV">
      <a href="./comics" >Comics</a>
      <a href="https://anti-spectacular.bandcamp.com/" target="_blank" rel="nofollow">Music</a>
      <a href="https://patreon.com/hausofdecline" target="_blank" rel="nofollow">Podcast</a>
      <a href="https://hausofdecline.bigcartel.com/" target="_blank" rel="nofollow">Store</a>
      <a href="https://patreon.com/hausofdecline" target="_blank" rel="nofollow">Patreon</a>
      <a href="./about">About</a>
    </nav>

    <nav class="mobileNAV">
      <a href="./comics" >Comics</a>
      <a href="https://anti-spectacular.bandcamp.com/" target="_blank" rel="nofollow">Music</a>
      <a href="https://patreon.com/hausofdecline" target="_blank" rel="nofollow">Podcast</a>
      <br>
      <a href="https://hausofdecline.bigcartel.com/" target="_blank" rel="nofollow">Store</a>
      <a href="https://patreon.com/hausofdecline" target="_blank" rel="nofollow">Patreon</a>
      <a href="./about">About</a>
    </nav>
  </header>

  <main>
    <div class="comicContainer">
      <noscript>
        <p style="text-align: center; border: 1px dashed;">Please enable JavaScript to browse comics</p>
      </noscript>

      <div class="comicControls">
        <div id="firstComic">↞</div>
        <div id="backComic">←</div>
        <div id="randomComic">Random</div>
        <div id="forwardComic">→</div>
        <div id="latestComic">↠</div>
      </div>
      <h2 id="comicTitle"></h2>
      <img id="viewedComic" class="comic">

      <div class="comicControls2">
        <div id="firstComic2">↞</div>
        <div id="backComic2">←</div>
        <div id="randomComic2">Random</div>
        <div id="forwardComic2">→</div>
        <div id="latestComic2">↠</div>
      </div>

    </div>

    <div class="searchBar">
      <input id="comicIdSearch" class="borderimg" type="number" placeholder="Comic #">
      <button id="comicIdLookup">Search</button>
    </div>

<!--     <div class="searchBar">
      <input class="borderimg" type="" placeholder="Keyword...">
      <button>Search</button>
    </div> -->

  </main>

  <footer>
    <div>
      <div><a href="https://x.com/hausofdecline" target="_blank" rel="nofollow">twitter</a></div>
      <div><a href="https://hausofdecline.bsky.social" target="_blank" rel="nofollow">bsky</a></div>
      <div><a href="https://www.instagram.com/hausofdecline/" target="_blank" rel="nofollow">instagram</a></div>
      <div><a href="https://www.youtube.com/@hausofdecline" target="_blank" rel="nofollow">youtube</a></div>
      <div><a href="" target="_blank" rel="nofollow">discord</a></div>
    </div>

    <div style="display: flex; flex-direction: column; justify-content: center;">
      <div>© Haus of Decline 2025</div>
      <div>website by <a href="https://steviep.xyz" target="_blank">steviep</a></div>
    </div>
  </footer>

</body>

<script type="module">
  import { $ } from './$.js'

  const $viewedComic = $.id('viewedComic')
  const $comicTitle = $.id('comicTitle')
  const $comicIdSearch = $.id('comicIdSearch')
  const $comicIdLookup = $.id('comicIdLookup')

  let u = new URL(window.location)
  let requestedComic = u.searchParams.get('comic')


function parseCsvLine(line) {
  const result = []
  let value = ''
  let inQuotes = false

  for (let i = 0; i < line.length; i++) {
    const char = line[i]
    const nextChar = line[i + 1]

    if (char === '"' && inQuotes && nextChar === '"') {
      value += '"'
      i++ // skip escaped quote
    } else if (char === '"') {
      inQuotes = !inQuotes
    } else if (char === ',' && !inQuotes) {
      result.push(value)
      value = ''
    } else {
      value += char
    }
  }

  result.push(value) // last value (after final comma)
  return result
}


function csvToJson(csvString) {
  const [headerLine, ...lines] = csvString.trim().split('\n')
  const headers = headerLine.split(',').map(h => h.replaceAll('"', '').trim())

  const json = lines.map(line => {
    const values = parseCsvLine(line)
    const valuesClean = values.map(v => v.replaceAll('"', '').trim())
    const entry = {}
    headers.forEach((header, i) => {
      entry[header] = valuesClean[i]
    })
    return entry
  })

  return json
}

  async function getComicData() {
    // const SHEET_ID = '1f8kqjWd4XYfUt-go2lsT-3-_Ex6fVeAKwVjSOvEF52g';

    // return fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv`)
    return fetch(`./GayComicsMetadata.csv`)
      .then(res => res.text())
      .then(csv => {
        return csvToJson(csv)
      })
  }

  const loadedData = getComicData()

  async function selectComic(id) {
    const data = await loadedData

    const matchingComic = data.find(d => Number(d.id) === Number(id)) || data[data.length - 1]

    $viewedComic.src = './comics/GayComics/' + matchingComic.file_name
    $viewedComic.alt = matchingComic.description || `Gay Comic #${matchingComic.id}: ${matchingComic.title}`

    const publication = new Date(Number(matchingComic.created_at) * 1000)

    $comicTitle.innerHTML = `#${matchingComic.id}: ${matchingComic.title} <span class="publication">(Published: ${publication.getMonth() + 1}/${publication.getDate()}/${publication.getFullYear()})</span>`

    if (Number(id) === data.length) {
      $.id('latestComic').classList.add('disabled')
      $.id('latestComic2').classList.add('disabled')
      $.id('forwardComic').classList.add('disabled')
      $.id('forwardComic2').classList.add('disabled')
    } else {
      $.id('latestComic').classList.remove('disabled')
      $.id('latestComic2').classList.remove('disabled')
      $.id('forwardComic').classList.remove('disabled')
      $.id('forwardComic2').classList.remove('disabled')
    }


    if (Number(id) === 1) {
      console.log('sdfsdf')
      // TODO disable back
      $.id('firstComic').classList.add('disabled')
      $.id('firstComic2').classList.add('disabled')
      $.id('backComic').classList.add('disabled')
      $.id('backComic2').classList.add('disabled')
    } else {
      $.id('firstComic').classList.remove('disabled')
      $.id('firstComic2').classList.remove('disabled')
      $.id('backComic').classList.remove('disabled')
      $.id('backComic2').classList.remove('disabled')
    }
  }

  async function displayComic(id) {
    const data = await loadedData

    if (id != null) {
      selectComic(id)

      requestedComic = id
      u.searchParams.set('comic', id)
      window.history.replaceState({}, '', u)
    } else {
      selectComic(data.length)
    }

  }



  displayComic(requestedComic)


  const firstComic = async () => {
    displayComic(1)
  }
  const backComic = async () => {
    const data = await loadedData
    if (Number(requestedComic) != 0) {
      displayComic(Number(requestedComic) - 1)
    } else if (!requestedComic) {
      displayComic(data.length - 1)
    }
  }
  const randomComic = async () => {
    const data = await loadedData
    displayComic(parseInt(Math.random() * data.length) + 1)
  }
  const forwardComic = async () => {
    const data = await loadedData
    if (requestedComic != null) {
      displayComic(Number(requestedComic) + 1)
    }
  }
  const latestComic = async () => {
    const data = await loadedData
    displayComic(data.length)
  }

  $.id('firstComic').onclick = firstComic
  $.id('firstComic2').onclick = () => {
    firstComic()
    window.scrollTo(0, 0)
  }

  $.id('backComic').onclick = backComic
  $.id('backComic2').onclick = () => {
    backComic()
    window.scrollTo(0, 0)
  }

  $.id('randomComic').onclick = randomComic
  $.id('randomComic2').onclick = () => {
    randomComic()
    window.scrollTo(0, 0)
  }

  $.id('forwardComic').onclick = forwardComic
  $.id('forwardComic2').onclick = () => {
    forwardComic()
    window.scrollTo(0, 0)
  }

  $.id('latestComic').onclick = latestComic
  $.id('latestComic2').onclick = () => {
    latestComic()
    window.scrollTo(0, 0)
  }


  $comicIdSearch.onkeydown = e => {
    if (e.key === 'Enter') {
      displayComic(e.target.value)
      $comicIdSearch.value = ''
      window.scrollTo(0, 0)
    }
  }

  comicIdLookup.onclick = () => {
    displayComic($comicIdSearch.value)
    $comicIdSearch.value = ''
    window.scrollTo(0, 0)

  }


//

</script>

</html>