<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Haus of Decline</title>

  <link rel="shortcut icon" type="image/x-icon" href="./favicon.jpg" id="favicon">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#000" />

  <meta name="description" content="">
  <meta name="keywords" content="">

  <meta name="twitter:image" content="">
  <meta name="twitter:image:alt" content="">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:creator" content="@hausofdecline">
  <meta name="twitter:site" content="@hausofdecline">
  <meta property="twitter:description" content="">

  <meta name="og:image" property="og:image" content="">
  <meta name="og:image:alt" content="">
  <meta property="og:type" content="website">
  <meta property="og:url" content="">
  <meta property="og:title" content="">
  <meta property="og:site_name" content="">
  <meta property="og:description" content="">


  <link rel="stylesheet" type="text/css" href="./style.css">

  <style type="text/css">

    * {
      font-family: sans-serif;
      --text-color:  var(--dark-color);
      --bg-color: var(--light-color);
    }

    body {
      background-image: url("./assets/bg.jpg");
    }

    #title {
      padding: 0.5em;
      text-align: center;
      line-height: 0;
    }
    #title img {
      filter: invert(1) contrast(2);
      max-height: 120px;
      width: auto;
      height: auto;
    }

    a, a:visited {
      color: var(--text-color);
    }

    a:hover {
      text-decoration: none;
    }

    header {
      margin-bottom: 1em;
    }



    img.comic {
      max-width: 100%;
      max-height: 70vh;
      width: auto;
      height: auto;
    }

    .comicContainer {
      margin-top: 2.5em;
      display: flex;
      justify-content: center;
      /*align-items: center;*/
      flex-direction: column;
    }

    #comicTitle {
      text-align: right;
      font-size: 1em;
      font-weight: normal;
      text-align: center;
    }
    nav {
      display: flex;
      justify-content: space-around;
    }


    header, main, footer {
      background: var(--bg-color);
    }

    nav a {
      font-size: 1.25em;
    }

    footer {
      display: flex;
      justify-content: space-between;
      margin: 1em auto;
      width: 320px;
    }

    button {
      padding: 0.4em 0.75em;
      background: var(--text-color);
      color: var(--bg-color);
      border: 0;
      border-radius: 2px;
    }

    input {
      padding: 0.25em;
    }

    .comicControls {
      display: flex;
      justify-content: space-around;
      margin:  auto;
      max-width: 320px;
      width: 100%;
    }

    .comicControls div {
      font-size: 2em;
      cursor: pointer;
    }

    .searchBar {
      text-align: center;
      margin: 0.5em 0;
    }

    .mobileNAV {
      display: none;
      text-align: center;
    }

    .borderimg {
      border: 20px solid transparent;
      border-image: url('./assets/border-image.png') 60 round;
    }



    @media (max-width:  640px) {
      .mobileNAV {
        display: block;
      }

      .desktopNAV {
        display: none;

      }

      nav a {
        font-size: 0.9em;
        margin: 0 0.25em;
      }
    }

  </style>
</head>
<body>
  <header>
    <!-- <img id="title" src="./Haus_of_Decline_Long.jpg"> -->
    <h1 id="title">
      <img  src="./assets/Haus_of_Decline_Cropped.jpeg" alt="HAUS OF DECLINE">
    </h1>
    <nav class="desktopNAV">
      <a href="./comics" >Comics</a>
      <a href="https://anti-spectacular.bandcamp.com/" target="_blank" rel="nofollow">Music</a>
      <a href="https://patreon.com/hausofdecline" target="_blank" rel="nofollow">Podcast</a>
      <a href="https://hausofdecline.bigcartel.com/" target="_blank" rel="nofollow">Store</a>
      <a href="https://patreon.com/hausofdecline" target="_blank" rel="nofollow">Patreon</a>
      <a href="./about">About</a>
    </nav>

    <nav class="mobileNAV">
      <a href="./comics" >Comics</a>
      <a href="https://anti-spectacular.bandcamp.com/" target="_blank" rel="nofollow">Music</a>
      <a href="https://patreon.com/hausofdecline" target="_blank" rel="nofollow">Podcast</a>
      <br>
      <a href="https://hausofdecline.bigcartel.com/" target="_blank" rel="nofollow">Store</a>
      <a href="https://patreon.com/hausofdecline" target="_blank" rel="nofollow">Patreon</a>
      <a href="./about">About</a>
    </nav>
  </header>

  <main>
    <div class="comicContainer">
      <noscript>
        <p style="text-align: center; border: 1px dashed;">Please enable JavaScript to browse comics</p>
      </noscript>

      <div class="comicControls">
        <div id="firstComic">‚Üû</div>
        <div id="backComic">‚Üê</div>
        <div id="randomComic">üé≤</div>
        <div id="forwardComic">‚Üí</div>
        <div id="latestComic">‚Ü†</div>
      </div>
      <img id="viewedComic" class="comic">
      <h2 id="comicTitle"></h2>

    </div>

    <div class="searchBar">
      <input class="borderimg" type="" placeholder="Comic #">
      <button>Search</button>
    </div>

    <div class="searchBar">
      <input class="borderimg" type="" placeholder="Keyword...">
      <button>Search</button>
    </div>

  </main>

  <footer>
    <div>
      <div><a href="">twitter</a></div>
      <div><a href="">bsky</a></div>
      <div><a href="">instagram</a></div>
      <div><a href="">youtube</a></div>
      <div><a href="">discord</a></div>
    </div>

    <div style="display: flex; flex-direction: column; justify-content: center;">
      <div>¬© Haus of Decline 2025</div>
      <div>website by <a href="https://steviep.xyz" target="_blank">steviep</a></div>
    </div>
  </footer>

</body>

<script type="module">
  import { $ } from './$.js'

  const $viewedComic = $.id('viewedComic')
  const $comicTitle = $.id('comicTitle')

  let u = new URL(window.location)
  let requestedComic = u.searchParams.get('comic')


function csvToJson(csvString) {
  const [headerLine, ...lines] = csvString.trim().split('\n')
  const headers = headerLine.split(',').map(h => h.replaceAll('"', '').trim())

  const json = lines.map(line => {
    const values = line.split(',').map(v => v.replaceAll('"', '').trim())
    const entry = {}
    headers.forEach((header, i) => {
      entry[header] = values[i]
    })
    return entry
  })

  return json
}


  async function getComicData() {
    const SHEET_ID = '1f8kqjWd4XYfUt-go2lsT-3-_Ex6fVeAKwVjSOvEF52g';

    return fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv`)
      .then(res => res.text())
      .then(csv => {
        return csvToJson(csv)
      })
  }

  const loadedData = getComicData()

  async function selectComic(id) {
    const data = await loadedData

    const matchingComic = data.find(d => Number(d.id) === Number(id)) || data[data.length - 1]

    $viewedComic.src = matchingComic.image_url
    $viewedComic.alt = matchingComic.description || `Gay Comic #${matchingComic.id}: ${matchingComic.title}`

    if (id === data.length) {
      // TODO disable forward
    }
    if (id === 0) {
      // TODO disable back

    }
  }

  async function displayComic(id) {
    const data = await loadedData

    console.log(id)

    if (id != null) {
      selectComic(id)

      requestedComic = id
      u.searchParams.set('comic', id)
      window.history.replaceState({}, '', u)
    } else {
      selectComic(data.length)
    }

  }



  displayComic(requestedComic)

  $.id('firstComic').onclick = async () => {
    displayComic(1)
  }

  $.id('backComic').onclick = async () => {
    console.log('sadas')
    const data = await loadedData
    if (Number(requestedComic) != 0) {
      displayComic(Number(requestedComic) - 1)
    } else if (!requestedComic) {
      displayComic(data.length - 1)
    }
  }

  $.id('randomComic').onclick = async () => {
    const data = await loadedData
    displayComic(parseInt(Math.random() * data.length) + 1)
  }

  $.id('forwardComic').onclick = async () => {
    const data = await loadedData
    if (requestedComic != null) {
      displayComic(Number(requestedComic) + 1)
    }
  }

  $.id('latestComic').onclick = async () => {
    const data = await loadedData
    displayComic(data.length)
  }


//

</script>

</html>